@startuml Sequence_Product_Management

skinparam backgroundColor #FEFEFE
skinparam sequenceMessageAlign center
skinparam responseMessageBelowArrow true
skinparam shadowing false
skinparam defaultFontName Arial

title Product Management - Sequence Diagram (Command Pattern)\n<size:12>CRUD Operations on Product Catalog using Command Pattern and Specialization</size>

actor User
participant "app:App" as App

box "commands" #FFFDE7
    participant "cmdAddFood:\nCommandProductAddFood" as CmdAddFood
    participant "cmdUpdate:\nCommandProductUpdate" as CmdUpdate
    participant "cmdList:\nCommandProductList" as CmdList
    participant "cmdRemove:\nCommandProductRemove" as CmdRemove
end box

box "controller" #E3F2FD
    participant "pfmController:\nProductFoodMeetingController" as PFMC
    participant "productController:\nProductController" as PC
end box

box "persistence" #FFF3E0
    participant "productDB:\nProductDB" as PDB
end box

box "models" #FCE4EC
    participant "product:\nProductMeeting" as ProductM
    participant "<<enumeration>>\nCategories" as Cat
end box


== Product Add (Specialized Flow: Food/Meeting) ==

autonumber "<b>[0]"

User -> App ++: prod add food <id> <name> <price> <date> <maxPers>
activate User

App -> App: parse command (args)

App -> CmdAddFood **: new CommandProductAddFood(args)
App -> CmdAddFood ++: execute()

CmdAddFood -> PFMC ++: add(id, name, price, date, maxPers)

PFMC -> Cat ++: valueOf(category)
Cat --> PFMC --: Categories enum

PFMC -> PDB ++: existeId(id)
PDB --> PFMC --: return boolean

alt ID doesn't exist

    PFMC -> PFMC: checkCapacity() ' Validar counter < 200

    alt counter < 200
        create ProductM
        PFMC -> ProductM **: new ProductMeeting(...)

        PFMC -> PDB ++: addProduct(productM)
        PDB --> PFMC --: void

        PFMC -> CmdAddFood: return success message
        PFMC --> CmdAddFood --: void

        CmdAddFood --> App --: "prod add: ok\n"
        App -> User: "prod add: ok\n"

    else counter >= 200
        PFMC -> CmdAddFood: "Catálogo de productos lleno."
        PFMC --> CmdAddFood --: void
        CmdAddFood --> App --: "Catálogo de productos lleno."
        App -> User: "Catálogo de productos lleno."
    end

else ID exists
    PFMC -> CmdAddFood: "Error. Ya existe el id."
    PFMC --> CmdAddFood --: void
    CmdAddFood --> App --: "Error. Ya existe el id."
    App -> User: "Error. Ya existe el id."
end

deactivate User
deactivate App

|||

== Product Update ==

autonumber "<b>[0]"

User -> App ++: prod update <id> <field> <value>
activate User

App -> CmdUpdate **: new CommandProductUpdate(args)
App -> CmdUpdate ++: execute()

CmdUpdate -> PC ++: update(id, field, value)

PC -> PDB ++: getProduct(id)
PDB --> PC --: return Product

alt Product exists
    PC -> Product: update method
    PC -> PDB ++: updateProduct(product) ' (Asumiendo un método de DB para actualizar)
    PDB --> PC --: void

    PC --> CmdUpdate --: "prod update: ok\n"
    CmdUpdate --> App --: "prod update: ok\n"
    App -> User: "prod update: ok\n"

else ID doesn't exist
    PC --> CmdUpdate --: "Error. No existe el id."
    CmdUpdate --> App --: "Error. No existe el id."
    App -> User: "Error. No existe el id."
end

deactivate User
deactivate App

|||

== Product List ==

autonumber "<b>[0]"

User -> App ++: prod list
activate User

App -> CmdList **: new CommandProductList()
App -> CmdList ++: execute()

CmdList -> PC ++: list()

PC -> PDB ++: listProducts()
PDB --> PC --: return products: ArrayList<Product>

loop for each product
    PC -> CmdList: print product details
end

PC --> CmdList --: void
CmdList --> App --: "prod list: ok\n"
App -> User: "prod list: ok\n"

deactivate User
deactivate App

|||

== Product Remove ==

autonumber "<b>[0]"

User -> App ++: prod remove <id>
activate User

App -> CmdRemove **: new CommandProductRemove(id)
App -> CmdRemove ++: execute()

CmdRemove -> PC ++: remove(id)

PC -> PDB ++: removeProduct(id)
return success/error

alt Success
    PC --> CmdRemove --: "prod remove: ok\n"
    CmdRemove --> App --: "prod remove: ok\n"
    App -> User: "prod remove: ok\n"

else Error (ID doesn't exist)
    PC --> CmdRemove --: "Error. ID no existe."
    CmdRemove --> App --: "Error. ID no existe."
    App -> User: "Error. ID no existe."
end

deactivate User
deactivate App

note over App, PC
  <b>Patrones Aplicados:</b>
  • Command Pattern: App llama a Command.
  • Specialization: Comando especializado llama a Controlador especializado.
  • Persistence: El Controller interactúa con la ProductDB.
end note

@enduml