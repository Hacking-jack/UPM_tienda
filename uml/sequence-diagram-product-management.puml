@startuml Sequence_Product_Management

skinparam backgroundColor #FEFEFE
skinparam sequenceMessageAlign center
skinparam responseMessageBelowArrow true
skinparam shadowing false
skinparam defaultFontName Arial

title Product Management - Sequence Diagram (Command Pattern)\n<size:12>CRUD Operations on Product Catalog using Command Pattern and Specialization</size>

actor User
participant "app:App" as App

box "commands" #FFFDE7
    participant "cmdAddFood:\nCommandProductAddFood" as CmdAddFood
    participant "cmdUpdate:\nCommandProductUpdate" as CmdUpdate
    participant "cmdList:\nCommandProductList" as CmdList
    participant "cmdRemove:\nCommandProductRemove" as CmdRemove
end box

box "controller" #E3F2FD
    participant "pfmController:\nProductFoodMeetingController" as PFMC
    participant "productController:\nProductController" as PC
end box

box "persistence" #FFF3E0
    participant "productDB:\nProductDB" as PDB
end box

box "models" #FCE4EC
    participant "product:\nProductMeeting" as ProductM
    participant "<<enumeration>>\nCategories" as Cat
end box

== Product Add (Specialized Flow: Food/Meeting) ==

autonumber "<b>[0]"

User -> App ++: prod add food <id> <name> <price> <date> <maxPers>
activate User

App -> CmdAddFood **: new CommandProductAddFood(args)
activate CmdAddFood
App -> CmdAddFood ++: execute()

CmdAddFood -> PFMC ++: add(id, name, price, date, maxPers)
activate PFMC

PFMC -> Cat: valueOf(category)
Cat --> PFMC: Categories enum

PFMC -> PDB ++: existeId(id)
activate PDB
PDB --> PFMC: boolean
deactivate PDB

alt ID doesn't exist
    PFMC -> PFMC: checkCapacity()
    note over PFMC: counter < 200 ?

    alt counter < 200
        create ProductM
        PFMC -> ProductM **: new ProductMeeting(...)
        activate ProductM
        deactivate ProductM

        PFMC -> PDB ++: addProduct(productM)
        activate PDB
        PDB --> PFMC: void
        deactivate PDB

        PFMC --> CmdAddFood: success
        deactivate PFMC
        CmdAddFood --> App: "prod add: ok"
        deactivate CmdAddFood
        App -> User: "prod add: ok"

    else counter >= 200
        PFMC --> CmdAddFood: "Catálogo lleno"
        deactivate PFMC
        CmdAddFood --> App: "Catálogo lleno"
        deactivate CmdAddFood
        App -> User: "Catálogo lleno"
    end

else ID exists
    PFMC --> CmdAddFood: "Error. Ya existe el id."
    deactivate PFMC
    CmdAddFood --> App: "Error. Ya existe el id."
    deactivate CmdAddFood
    App -> User: "Error. Ya existe el id."
end

deactivate User
deactivate App

|||

== Product Update ==

autonumber "<b>[0]"

User -> App ++: prod update <id> <field> <value>
activate User

App -> CmdUpdate **: new CommandProductUpdate(args)
activate CmdUpdate
App -> CmdUpdate ++: execute()

CmdUpdate -> PC ++: update(id, field, value)
activate PC

PC -> PDB ++: getProduct(id)
activate PDB
PDB --> PC: Product
deactivate PDB

alt Product exists
    PC -> Product: update(field, value)
    PC -> PDB ++: updateProduct(product)
    activate PDB
    PDB --> PC: void
    deactivate PDB

    PC --> CmdUpdate: "prod update: ok"
    deactivate PC
    CmdUpdate --> App: "prod update: ok"
    deactivate CmdUpdate
    App -> User: "prod update: ok"

else ID doesn't exist
    PC --> CmdUpdate: "Error. No existe el id."
    deactivate PC
    CmdUpdate --> App: "Error. No existe el id."
    deactivate CmdUpdate
    App -> User: "Error. No existe el id."
end

deactivate User
deactivate App

|||

== Product List ==

autonumber "<b>[0]"

User -> App ++: prod list
activate User

App -> CmdList **: new CommandProductList()
activate CmdList
App -> CmdList ++: execute()

CmdList -> PC ++: list()
activate PC

PC -> PDB ++: listProducts()
activate PDB
PDB --> PC: ArrayList<Product>
deactivate PDB

loop for each product
    PC -> CmdList: print product details
end

PC --> CmdList: void
deactivate PC
CmdList --> App: "prod list: ok"
deactivate CmdList
App -> User: "prod list: ok"

deactivate User
deactivate App

|||

== Product Remove ==

autonumber "<b>[0]"

User -> App ++: prod remove <id>
activate User

App -> CmdRemove **: new CommandProductRemove(id)
activate CmdRemove
App -> CmdRemove ++: execute()

CmdRemove -> PC ++: remove(id)
activate PC

PC -> PDB ++: removeProduct(id)
activate PDB
PDB --> PC: success/error
deactivate PDB

alt Success
    PC --> CmdRemove: "prod remove: ok"
    deactivate PC
    CmdRemove --> App: "prod remove: ok"
    deactivate CmdRemove
    App -> User: "prod remove: ok"

else Error (ID doesn't exist)
    PC --> CmdRemove: "Error. ID no existe."
    deactivate PC
    CmdRemove --> App: "Error. ID no existe."
    deactivate CmdRemove
    App -> User: "Error. ID no existe."
end

deactivate User
deactivate App

note over App, PC
  <b>Patrones Aplicados:</b>
  • Command Pattern: App llama a Command.
  • Specialization: Comando especializado llama a Controlador especializado.
  • Persistence: El Controller interactúa con la ProductDB.
end note

@enduml
