@startuml Activity_Diagram

skinparam backgroundColor #FEFEFE
skinparam defaultFontName Arial
skinparam activityDiamondBackgroundColor #E3F2FD
skinparam activityStartColor #4CAF50
skinparam activityEndColor #F44336
skinparam activityBackgroundColor #FFF9C4
skinparam activityBorderColor #FBC02D
skinparam activityFontSize 10

title UPM Tienda - Activity Diagram\n<size:12>Main Application Flow using Command Pattern</size>

start

partition "View (App)" #E8F5E9 {
  :Initialize Application\n(Controllers, DBs, Ticket);
  note left
    <b>View Responsibilities:</b>
    • Handle I/O (read/print)
    • Command dispatch
    • Error presentation
  end note
  :Display prompt "tUPM>";
}

repeat
  partition "View (App)" {
    :Read user input command;
    :Parse command (split by spaces);
  }

  partition "Command Layer" #FFFDE7 {
    :Create Command instance\n[e.g., CommandProductAddFood];

    switch (Command Type?)

    case (help, echo, exit)
      :Execute simple command;

    case (prod, ticket, cash, client)
      :Execute business logic command;

      partition "Controller (Business Logic)" #E3F2FD {
        :Call method on appropriate Controller\n[e.g., ProductFoodMeetingController.add(...)];
        note right
          <b>Controller Responsibilities:</b>
          • Business rules (capacity, discounts)
          • Data access (via DBs)
          • State changes (Ticket state)
        end note

        switch (Operation Type)
        case (Add Product)
          :Validate category & ID;
          :Check catalog capacity (200 max);
          :Save via ProductDB;

        case (Add to Ticket)
          :Check product ID existence (via DB);
          :Check ticket capacity (100 max);
          :Update Ticket state (VACIO -> ACTIVO);
          :Calculate and print receipt;

        case (Remove Product)
          :Check ID existence;
          :Remove from ProductDB;

        case (Print Ticket)
          :Execute printAndClose() on Ticket;
          :Update Ticket state (ACTIVO -> CERRADO);

        endswitch
      }

      :Process result from Controller;

    endswitch
  }

  partition "View (App)" {
    if (Error occurred?) then (yes)
      :Display error message\n(e.g., "ID no existe", "Ticket lleno");
    else (no)
      :Display success message\n(e.g., "prod add: ok");
    endif
  }

repeat while (Exit command?) is (not executed)
->exit executed;

partition "View (App)" {
  :Display "Closing application";
}

stop

legend left
  <b>Partitions (Swimlanes):</b>
  • Green: User Interaction (View)
  • Yellow: Decoupling (Command)
  • Blue: Core Logic (Controller)
endlegend
@enduml