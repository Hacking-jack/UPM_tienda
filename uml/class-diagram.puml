@startuml UPM_Tienda_Class_Diagram

skinparam classAttributeIconSize 0
skinparam linetype ortho
skinparam packageStyle rectangle
skinparam shadowing false
skinparam backgroundColor #FEFEFE
skinparam defaultFontName Arial
skinparam abstractFontStyle bold

title UPM Tienda - Class Diagram (Entrega 2)\n<size:12>Store Management System with Users, Products, Databases, and Command Pattern</size>

package "view" <<Rectangle>> #E8F5E9 {
    class App {
        - ticket: Ticket
        - productController: ProductController
        - ticketController: TicketController
        - clientController: ClientController
        - cashierController: CashierController
        __Constructors__
        + App()
        __Methods__
        + {static} main(args: String[]): void
        - iniciar(): void
        - run(): void
    }
}

package "database" <<Rectangle>> #FFF3E0 {
    class HumanDB {
        + addHuman(human: Human): void
        + removeHuman(dni: String): void
        + listHumans(): ArrayList<Human>
    }
    class ProductDB {
        + addProduct(product: Product): void
        + removeProduct(id: int): void
        + getProduct(id: int): Product
        + {static} addProductClone(product: Product): void
    }
    class TicketDB {
        + addTicket(ticket: Ticket): void
        + getTicket(id: String): Ticket
    }
}

package "controller" <<Rectangle>> #E3F2FD {
    abstract class HumanController {
        # humanDB: HumanDB
    }

    class ClientController extends HumanController {
        + addClient(name: String, dni: String, email: String, cashier: Cashier): void
        + removeClient(dni: String): void
        + listClients(): void
    }

    class CashierController extends HumanController {
        + addCashier(id: String, name: String, email: String): void
        + removeCashier(id: String): void
        + listCashiers(): void
    }

    abstract class ProductController {
        # productDB: ProductDB
        - counter: int
        + add(product: Product): void
        + list(): void
        + update(product: Product): void
        + remove(id: int): void
        + existeId(id: int): boolean
        + productoID(id: int): Product
    }

    class ProductCustomController extends ProductController {}
    class ProductFoodMeetingController extends ProductController {}

    class TicketController {
        - ticketDB: TicketDB
        - ticket: Ticket
        - counter: int
        + newTicket(): void
        + add(product: Product, quantity: int): void
        + remove(product: Product): void
        + print(): void
    }
}

package "commands" <<Rectangle>> #FFFDE7 {
    interface Command {
        + execute(): void
    }
    class CommandCashAdd implements Command {}
    class CommandClientAdd implements Command {}
    class CommandProductAdd implements Command {}
    class CommandProductAddFood implements Command {}
    class CommandTicketAddProduct implements Command {}
}

package "exceptions" <<Rectangle>> #FFEBEE {
    abstract class AppException extends Exception
    class MaxAssistantOutOfBounds extends AppException {}
    class NegativeNumException extends AppException {}
    class ProductNotFound extends AppException {}
    class TicketNotFound extends AppException {}
    class UserNotFound extends AppException {}
}

package "models" <<Rectangle>> #FCE4EC {
    abstract class Human {
        # id: String
        # nombre: String
        # email: String
        # tickets: ArrayList<String>
        + addTicket(ticketId: String): void
        + {abstract} getId(): String
    }

    class Client extends Human {
        - cajeroAlta: String
        + Client(nombre: String, dni: String, email: String, cajeroAlta: String)
        + toString(): String
    }

    class Cashier extends Human {
        + Cashier(id: String, nombre: String, email: String)
        + toString(): String
    }

    class Product {
        # name: String
        # categories: Categories
        # price: double
        + id: int {readOnly}
        + getPrice(): double
        + clone(): Product
    }

    class ProductCustom extends Product {
        + maxPers: int
        - listaPers: String[]
        - persAct: int
        + addPers(pers: String[]): void
        + getPrice(): double
        + clone(): ProductCustom
    }

    class ProductMeeting extends Product {
        - date: LocalDate
        - maxParticipantes: int
        - isFood: boolean
        - asistentes: int
        + setAsistentes(asistentes: int): boolean
        + getPrice(): double
        + clone(): ProductMeeting
    }

    class Ticket {
        - products: ArrayList<Product>
        - idTicket: String
        - date: LocalDateTime
        - estado: States
        + addProduct(product: Product): boolean
        + addMeeting(productMeeting: ProductMeeting): void
        + removeProduct(product: Product): void
        + printAndClose(): void
    }

    enum States {
        VACIO
        ACTIVO
        CERRADO
    }

    enum Categories {
        MERCH
        STATIONERY
        CLOTHES
        BOOK
        ELECTRONICS
        + {static} getDiscount(categorie: Categories): double
    }
}

' Relaciones principales
Ticket "1" o-- "0..100" Product : <<contains>>
Product "1" --> "1" Categories : <<categorized by>>
Ticket "1" --> "1" States : <<has state>>
Client "0..*" o-- "1" Cashier : <<registered by>>

ClientController ..> HumanDB : <<uses>>
CashierController ..> HumanDB : <<uses>>
ProductController ..> ProductDB : <<uses>>
TicketController ..> TicketDB : <<uses>>
ProductCustomController ..> ProductDB : <<uses>>
ProductFoodMeetingController ..> ProductDB : <<uses>>

Command <|.. CommandClientAdd
CommandClientAdd ..> ClientController : <<requests>>
Command <|.. CommandCashAdd
CommandCashAdd ..> CashierController : <<requests>>
Command <|.. CommandProductAddFood
CommandProductAddFood ..> ProductFoodMeetingController : <<requests>>
Command <|.. CommandTicketAddProduct
CommandTicketAddProduct ..> TicketController : <<requests>>

ProductCustom ..> ProductDB : <<static uses>>

legend right
  |= Symbol |= Meaning |
  | <|-- | Inheritance (Generalization) |
  | *-- | Composition |
  | o-- | Aggregation |
  | ..> | Dependency |
  | <|.. | Realization (Interface) |

  <b>Patterns:</b> MVC, Command
endlegend

@enduml
